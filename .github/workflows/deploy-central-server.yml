name: Central Server - Docker Image 

on:
  workflow_dispatch:
  workflow_run:
    workflows: ['Central Server - Docker Image']
    branches: ["main"]
    types: [completed]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4
    - name: Install kubectl
      uses: azure/setup-kubectl@v4
    - name: Configure kubeconfig
      uses: azure/k8s-set-context@v4
      with:
        method: kubeconfig
        kubeconfig: ${{ secrets.CENTRAL_SERVER_KUBECONFIG }}
    - name: Deploy to K8s cluster
      uses: azure/k8s-deploy@v5
      with:
        action: deploy
        manifests: |
          central_server/k8s
        images: |
         ${DOCKER_USERNAME}/pacman-central:latest:${{ vars.DOCKERHUB_USERNAME }}/pacman-central:latest

